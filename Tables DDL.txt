Hive Commands
*******************************************************************************************************************
*creating a table using select

-------------------------------------------------------------------------------------------------------------------------------------------------------------
Final Queries
1st Table 
CREATE TABLE stock_companies(
             symbol VARCHAR(5),
             company_name VARCHAR(38),
             sector VARCHAR(27),
             sub_industry VARCHAR(47),
             headquarter VARCHAR(47),
             Primary Key (symbol));
-------------------------------------------------------------------------------------------------------------------------------------------------------------
LOAD DATA LOCAL INFILE '/mnt/home/gyankrishnaagmail/StockCompanies.csv' 
INTO TABLE stock_companies
FIELDS TERMINATED BY ',' 
OPTIONALLY ENCLOSED BY '"'
ESCAPED BY '\;'
LINES TERMINATED BY '\r\n'
IGNORE 1 ROWS;
-------------------------------------------------------------------------------------------------------------------------------------------------------------
2nd Table
CREATE TABLE stock_prices (
             trading_date Date,
             symbol VARCHAR(5),
             open DOUBLE,
             close DOUBLE,
             low DOUBLE,
             high DOUBLE,
             volume INT
             );
-------------------------------------------------------------------------------------------------------------------------------------------------------------
LOAD DATA LOCAL INFILE '/mnt/home/gyankrishnaagmail/StockPrices.csv' 
INTO TABLE stock_prices
FIELDS TERMINATED BY ',' 
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;
-------------------------------------------------------------------------------------------------------------------------------------------------------------

Hive table ddl
CREATE TABLE stock_companies_fhp(
             symbol VARCHAR(5),
             company_name VARCHAR(38),
             sector VARCHAR(27),
             sub_industry VARCHAR(47),
             headquarter VARCHAR(47))
             row format delimited
             FIELDS TERMINATED BY '\t'
             LINES TERMINATED BY '\n'
             stored as textfile
             location "/tmp/gyankrishnaagmail/stock_companies"
-------------------------------------------------------------------------------------------------------------------------------------------------------------
Hive table ddl

-------------------------------------------------------------------------------------------------------------------------------------------------------------
For tables without Primary Key
sqoop import\
 --connect jdbc:mysql://sqoopdb.slbdh.cloudlabs.com/gyankrishnaagmail\
 --username gyankrishnaagmail\
 --password 'gyankrishnaagmailtltyi'\
 --split-by symbol\
 --table stock_prices\
 --fields-terminated-by ','\
 --hive-import\
 --hive-table stock_prices_fhp -m 1; 
-------------------------------------------------------------------------------------------------------------------------------------------------------------
For tables with primary key
sqoop import\
 --connect jdbc:mysql://sqoopdb.slbdh.cloudlabs.com/gyankrishnaagmail\
 --username gyankrishnaagmail\
 --password 'gyankrishnaagmailtltyi'\
 --split-by symbol\
 --table stock_companies\
 --fields-terminated-by ','\
 --hive-import\
 --hive-table stock_companies_fhp -m 1; 
-------------------------------------------------------------------------------------------------------------------

Sql to create a new tables for question 2 
-----------------------------------------
CREATE TABLE stock_company_price AS\
 SELECT SUBSTR(trading_date,1,4),SUBSTR(trading_date,6,2),symbol,company_name,\
 headquarter,sector,sub_industry,open,close,low,high,volume\
 FROM stock_companies_fhp C JOIN stock_prices_fhp P\
 ON (C.symbol = P.symbol);


 SELECT SUBSTR(P.trading_date,1,4) AS Year,SUBSTR(P.trading_date,6,2) AS Month ,C.symbol,C.company_name,
 split(C.headquarter,';')[1],C.sector,C.sub_industry,avg(P.open),avg(P.close),avg(P.low),avg(P.high),avg(P.volume)
 FROM stock_companies_fhp C,
      stock_prices_fhp P
 WHERE C.symbol = P.symbol
 AND   SUBSTR(P.trading_date,1,4) = 2010 
 AND   SUBSTR(P.trading_date,6,2) = 01
 GROUP BY P.trading_date,C.symbol,C.company_name,C.headquarter,C.sector,C.sub_industry;

SELECT year(P.trading_date) AS Year,month(P.trading_date) AS Month ,C.symbol,C.company_name,
 split(C.headquarter,';')[1],C.sector,C.sub_industry,avg(P.open),avg(P.close),avg(P.low),avg(P.high),avg(P.volume)
 FROM stock_companies_fhp C,
      stock_prices_fhp P
 WHERE C.symbol = P.symbol
 AND   SUBSTR(P.trading_date,1,4) = 2010 
 AND   SUBSTR(P.trading_date,6,2) = 01
 GROUP BY year(P.trading_date),month(P.trading_date),C.symbol,C.company_name,C.headquarter,C.sector,C.sub_industry;
 	
	
	 


